<mat-toolbar color="primary" class="mat-elevation-z4 top-toolbar">
  <button mat-icon-button (click)="global.back()">
    <mat-icon>arrow_back</mat-icon>
  </button>

  <span>{{translation.transfer[global.lang]}}</span>
  <span class="fill-remaining-space"></span>
  <button mat-icon-button routerLink="/transactions/scan">
    <mat-icon>center_focus_strong</mat-icon>
  </button>
</mat-toolbar>
<div class="mat-typography body-container">
  <mat-spinner *ngIf="loading; else loaded"></mat-spinner>
  <ng-template #loaded>
    <form #form="ngForm" (ngSubmit)="transfer()">
      <mat-card>
        <mat-form-field fxFill>
          <input matInput placeholder="{{translation.recipient[global.lang]}}" [(ngModel)]="forms.recipient" name="recipient"
            [matAutocomplete]="auto" (change)="onRecipientChange()" required minlength="40" maxlength="40" pattern="N.*">
          <mat-error>{{translation.addressRequired[global.lang]}}</mat-error>
        </mat-form-field>
        <mat-autocomplete #auto="matAutocomplete">
          <mat-option *ngFor="let autoComplete of autoCompletes" [value]="autoComplete">{{autoComplete}}</mat-option>
        </mat-autocomplete>
      </mat-card>
      <mat-card>
        <mat-form-field fxFill>
          <input matInput placeholder="{{translation.message[global.lang]}}" [(ngModel)]="forms.message" name="message"
            [required]="forms.encrypt">
          <mat-slide-toggle fxFill matSuffix [(ngModel)]="forms.encrypt" name="encrypt">{{translation.encryption[global.lang]}}</mat-slide-toggle>
        </mat-form-field>
      </mat-card>
      <mat-card>
        <div *ngFor="let asset of forms.transferAssets; let i = index; let l = last" fxLayout="row">
          <mat-form-field fxFlex="50">
            <mat-select color="accent" placeholder="{{translation.assetName[global.lang]}}" [(ngModel)]="asset.name"
              name="asset{{i}}-name" required="{{!l || forms.transferAssets.length == 1}}" (focus)="addAsset(i)">
              <ng-container *ngFor="let a of global.account.assets">
                <mat-option *ngIf="assetIsNotReady(a.name)" [value]="a.name">
                  <app-assets-list [assets]="[a.asset]"></app-assets-list>
                </mat-option>
              </ng-container>
            </mat-select>
          </mat-form-field>
          <ng-container *ngIf="!l">
            <mat-form-field class="fill-remaining-space">
              <input matInput color="accent" type="number" placeholder="{{translation.amount[global.lang]}}"
                [(ngModel)]="asset.amount" name="asset{{i}}-capacity" required min="1" minlength="1" pattern="[0-9]*" />
            </mat-form-field>
            <button mat-icon-button color="warn" type="button" (click)="deleteAsset(i)">
              <mat-icon>clear</mat-icon>
            </button>
          </ng-container>
        </div>
      </mat-card>
      <button fxFill mat-raised-button color="accent" [disabled]="form.invalid">{{translation.transfer[global.lang]}}</button>
    </form>
  </ng-template>
</div>